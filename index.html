<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; 
                   script-src 'self' 'unsafe-inline'; 
                   style-src 'self' 'unsafe-inline'; 
                   img-src 'self' data:; 
                   font-src 'self' data:; 
                   connect-src 'self' https://*.supabase.co; 
                   base-uri 'self'; 
                   form-action 'self'; 
                   upgrade-insecure-requests;" />

    <meta name="description"
        content="✨ The Coolest Todo App (ever) - A modern, feature-rich task management app with smart due dates, categories, and beautiful themes. Get things done with style!" />
    <meta name="keywords" content="todo, task manager, productivity, preact, vite, tailwind" />
    <meta name="author" content="Coolest Todo App Team" />
    <meta name="theme-color" content="#3b82f6" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="✨ The Coolest Todo App (ever)" />
    <meta property="og:description"
        content="Get things done with style! Modern todo app with smart features and beautiful themes." />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="✨ The Coolest Todo App (ever)" />
    <meta name="twitter:description"
        content="Get things done with style! Modern todo app with smart features and beautiful themes." />

    <!-- Favicon and Manifest -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="manifest" href="/site.webmanifest">

    <title>✨ The Coolest Todo App (ever) - Get Things Done with Style</title>

    <!-- Prevent dark mode flash by applying theme before render -->
    <script>
        (function () {
            try {
                // Get stored theme preference from localStorage
                // Note: storage service uses 'coolest-todo-' prefix and double-encodes JSON
                const stored = localStorage.getItem('coolest-todo-user-preferences');

                let theme = 'light';

                if (stored) {
                    try {
                        // Parse double-encoded JSON (storage service stringifies already-stringified data)
                        const preferencesString = JSON.parse(stored);
                        const preferences = JSON.parse(preferencesString);
                        theme = preferences.theme || 'light';

                        // If theme is 'system', detect system preference
                        if (theme === 'system') {
                            theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                        }
                    } catch (e) {
                        theme = 'light';
                    }
                }

                // Apply theme class to html element
                const root = document.documentElement;
                if (theme === 'dark') {
                    root.classList.add('dark');
                } else {
                    root.classList.remove('dark');
                }

                // Add class to disable transitions during page load
                root.classList.add('no-transitions');

                // CRITICAL: Set colors inline to prevent flash
                // These colors must match the CSS variables in index.css
                const bgColor = theme === 'dark' ? '#111827' : '#f9fafb';
                const textColor = theme === 'dark' ? '#f9fafb' : '#111827';

                // Apply to html element
                root.style.setProperty('background-color', bgColor, 'important');
                root.style.setProperty('color', textColor, 'important');

                // CRITICAL: Also set on body when it exists
                // This prevents flash when CSS variables load
                if (document.body) {
                    document.body.style.setProperty('background-color', bgColor, 'important');
                    document.body.style.setProperty('color', textColor, 'important');
                } else {
                    // Body doesn't exist yet, set it when DOM loads
                    document.addEventListener('DOMContentLoaded', function () {
                        if (document.body) {
                            document.body.style.setProperty('background-color', bgColor, 'important');
                            document.body.style.setProperty('color', textColor, 'important');
                        }
                    });
                }

                // Note: no-transitions class will be removed by themeService when React takes over
            } catch (e) {
                // Fallback to light theme on error
                const root = document.documentElement;
                root.classList.remove('dark');
                root.classList.add('no-transitions');
                root.style.setProperty('background-color', '#f9fafb', 'important');
                root.style.setProperty('color', '#111827', 'important');
            }
        })();
    </script>
</head>

<body>
    <div id="app"></div>
    <script type="module" src="/src/main.jsx"></script>

    <noscript>
        <div style="text-align: center; padding: 2rem; font-family: system-ui;">
            <h1>✨ Coolest Todo App</h1>
            <p>Please enable JavaScript to use this application.</p>
        </div>
    </noscript>
</body>

</html>